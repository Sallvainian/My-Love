# My-Love Project Documentation

> Comprehensive project documentation generated by BMAD document-project workflow.
> Last updated: 2026-01-30 | Scan level: Deep (Rescan)

## Documentation Index

| Document | Description |
|----------|-------------|
| [Project Context](./project-context.md) | AI-optimized quick reference |
| [Architecture Overview](./architecture-overview.md) | System architecture and patterns |
| [Technology Stack](./technology-stack.md) | Technologies and versions |
| [API Reference](./api-reference.md) | API layer documentation |
| [Data Models](./data-models.md) | Database schema and types |
| [State Management](./state-management.md) | Zustand store architecture |
| [Component Inventory](./component-inventory.md) | UI component catalog |
| [Service Layer](./service-layer.md) | Services and utilities |

## Planning Artifacts

| Document | Description | Date |
|----------|-------------|------|
| [PRD](../_bmad-output/planning-artifacts/prd.md) | Product Requirements Document | 2026-01-25 |
| [UX Design](../_bmad-output/planning-artifacts/ux-design-specification.md) | UX Design Specification | 2026-01-25 |
| [Architecture](../_bmad-output/planning-artifacts/architecture.md) | Feature Architecture (Scripture Reading) | 2026-01-26 |
| [Epics & Stories](../_bmad-output/planning-artifacts/epics.md) | Implementation breakdown | 2026-01-26 |
| [Test Design - Arch](../_bmad-output/test-design-architecture.md) | Test architecture & risks | 2026-01-27 |
| [Test Design - QA](../_bmad-output/test-design-qa.md) | QA execution recipe | 2026-01-27 |
| [Implementation Readiness](../_bmad-output/planning-artifacts/implementation-readiness-report-2026-01-27.md) | Readiness assessment | 2026-01-27 |

## Project Summary

**My-Love** is a Progressive Web App (PWA) for couples communication, featuring:

- **Daily Love Messages** - Rotating heartfelt messages (365 messages, 5 categories)
- **Love Notes Chat** - Real-time messaging between partners with image support
- **Mood Tracker** - Emoji-based mood logging (12 moods) with partner view and calendar
- **Photo Gallery** - Shared photo memories with captions, zoom, and swipe gestures
- **Partner Interactions** - Playful pokes and kisses with real-time delivery
- **Relationship Timers** - Countdown to anniversaries and birthdays
- **Scripture Reading** - *(In Development)* Guided spiritual reading for couples (17 steps, solo/together modes)

## Quick Stats

| Metric | Count |
|--------|-------|
| Source Files (TS/TSX) | 131 |
| API Files | 8 |
| Database Tables | 11 (6 original + 5 scripture) |
| Database Migrations | 8 |
| Zustand Slices | 10 |
| Service Files | 15 |
| UI Components | 71 files across 26 directories |
| Custom Hooks | 9 |
| CI Workflows | 5 |
| E2E Test Specs | 21 |
| Unit Test Files | 14+ (in src/ and tests/) |
| Utility Scripts | 9 |

## Key Technologies

- **Frontend**: React 19.2.3, TypeScript 5.9.3, Vite 7.3.1
- **State**: Zustand 5.0.10 with slice composition (10 slices)
- **Backend**: Supabase 2.90.1 (Auth, Database, Storage, Realtime, Edge Functions)
- **Styling**: Tailwind CSS 4.1.17, Framer Motion 12.27.1
- **Offline**: IndexedDB v5 (idb 8.0.3) with service worker (Workbox 7.4.0)
- **Validation**: Zod 4.3.5 at API boundaries + input validation schemas
- **Testing**: Vitest 4.0.17 (unit), Playwright 1.57.0 (E2E), tdd-guard-vitest
- **Deployment**: GitHub Pages via GitHub Actions
- **Runtime**: Node.js 24.13.0

## Architecture Pattern

- **Type**: Monolith SPA (Single Page Application)
- **Pattern**: Component-based with layered architecture
- **Data Flow**: Components → Hooks → Store (Zustand) → Services → API (Supabase)
- **Offline Strategy**: IndexedDB local storage + Supabase sync + Background Sync API
- **PWA**: Service worker with injectManifest strategy (Workbox)
- **Real-time**: Supabase Broadcast API (moods, love notes) + postgres_changes (interactions)

## Source Tree

```
my-love/                          # Project root
├── src/                          # Application source (131 TS/TSX files)
│   ├── App.tsx                   # ENTRY: Auth flow → Main app routing
│   ├── main.tsx                  # ENTRY: React DOM root + service worker registration
│   ├── sw.ts                     # Service worker (Workbox injectManifest)
│   ├── sw-db.ts                  # Service worker IndexedDB access
│   ├── index.css                 # Global styles (Tailwind base)
│   │
│   ├── api/                      # Supabase API layer (8 files)
│   │   ├── supabaseClient.ts     # Singleton client + partner helpers
│   │   ├── authService.ts        # Email/password + Google OAuth
│   │   ├── moodApi.ts            # Mood CRUD with Zod validation
│   │   ├── moodSyncService.ts    # Real-time mood sync (Broadcast API)
│   │   ├── interactionService.ts # Poke/kiss (postgres_changes)
│   │   ├── partnerService.ts     # Partner connection (RPC functions)
│   │   ├── errorHandlers.ts      # Retry, backoff, error classification
│   │   └── validation/           # Zod response schemas
│   │       └── supabaseSchemas.ts
│   │
│   ├── components/               # React UI (71 files, 26 directories)
│   │   ├── AdminPanel/           # Custom message CRUD (6 files)
│   │   ├── CountdownTimer/       # Anniversary countdown
│   │   ├── DailyMessage/         # Message card with swipe/share
│   │   ├── DisplayNameSetup/     # OAuth display name flow
│   │   ├── ErrorBoundary/        # Global error catch
│   │   ├── InteractionHistory/   # Poke/kiss history
│   │   ├── LoginScreen/          # Auth UI (email + Google)
│   │   ├── MoodHistory/          # Calendar view (3 files)
│   │   ├── MoodTracker/          # Mood logging (6 files)
│   │   ├── Navigation/           # Bottom nav (7 tabs)
│   │   ├── PartnerMoodView/      # Partner search + mood display
│   │   ├── PhotoCarousel/        # Swipe carousel (2 files)
│   │   ├── PhotoDeleteConfirmation/
│   │   ├── PhotoEditModal/       # Caption editing
│   │   ├── PhotoGallery/         # Grid + viewer (4 files)
│   │   ├── PhotoUpload/          # Multi-step upload
│   │   ├── PokeKissInterface/    # Interaction buttons
│   │   ├── RelationshipTimers/   # Timer panel (4 files)
│   │   ├── Settings/             # User settings + anniversaries
│   │   ├── ViewErrorBoundary/    # Route-level error boundary
│   │   ├── WelcomeButton/        # Trigger welcome splash
│   │   ├── WelcomeSplash/        # First-visit animation
│   │   ├── love-notes/           # Chat system (6 files + tests)
│   │   ├── photos/               # Photo uploader
│   │   ├── scripture-reading/    # NEW: Scripture feature
│   │   │   ├── containers/       # ScriptureOverview.tsx
│   │   │   └── __tests__/
│   │   └── shared/               # NetworkStatusIndicator, SyncToast
│   │
│   ├── hooks/                    # Custom React hooks (9 files)
│   │   ├── useAuth.ts            # Auth state
│   │   ├── useLoveNotes.ts       # Chat CRUD + pagination
│   │   ├── useRealtimeMessages.ts # Real-time subscriptions
│   │   ├── usePhotos.ts          # Photo operations
│   │   ├── useMoodHistory.ts     # Paginated mood history
│   │   ├── usePartnerMood.ts     # Partner mood + real-time
│   │   ├── useNetworkStatus.ts   # Online/offline detection
│   │   ├── useImageCompression.ts # Image processing wrapper
│   │   └── useVibration.ts       # Haptic feedback
│   │
│   ├── services/                 # Business logic (15 files)
│   │   ├── BaseIndexedDBService.ts  # Generic IDB CRUD base class
│   │   ├── dbSchema.ts           # IndexedDB schema v5 (8 stores)
│   │   ├── customMessageService.ts  # Custom love messages
│   │   ├── moodService.ts        # Mood IDB CRUD + sync tracking
│   │   ├── photoStorageService.ts   # Photo IDB + quota
│   │   ├── photoService.ts       # Supabase Storage operations
│   │   ├── imageCompressionService.ts # Canvas compression
│   │   ├── loveNoteImageService.ts  # Edge Function upload + LRU cache
│   │   ├── syncService.ts        # Offline→online sync
│   │   ├── realtimeService.ts    # Supabase Realtime channels
│   │   ├── scriptureReadingService.ts # NEW: Scripture CRUD + cache
│   │   ├── performanceMonitor.ts # Operation timing metrics
│   │   ├── migrationService.ts   # LS→IDB migration
│   │   └── storage.ts            # Legacy storage helper
│   │
│   ├── stores/                   # Zustand state (10 slices)
│   │   ├── useAppStore.ts        # Main composed store
│   │   ├── types.ts              # AppState type definition
│   │   └── slices/
│   │       ├── appSlice.ts       # Loading, error, hydration
│   │       ├── settingsSlice.ts  # User settings, onboarding
│   │       ├── messagesSlice.ts  # Daily messages, rotation
│   │       ├── photosSlice.ts    # Photo state
│   │       ├── navigationSlice.ts # View routing (6 views)
│   │       ├── moodSlice.ts      # Mood entries + sync
│   │       ├── interactionsSlice.ts # Poke/kiss
│   │       ├── partnerSlice.ts   # Partner connection
│   │       ├── notesSlice.ts     # Love notes chat
│   │       └── scriptureReadingSlice.ts # NEW: Scripture sessions
│   │
│   ├── config/                   # App configuration
│   │   ├── constants.ts          # App-wide constants
│   │   ├── images.ts             # Image paths
│   │   ├── performance.ts        # Performance thresholds
│   │   └── relationshipDates.ts  # Key dates
│   │
│   ├── data/                     # Static data
│   │   ├── defaultMessages.ts    # 365 love messages (5 categories)
│   │   └── scriptureSteps.ts     # NEW: 17 scripture steps (NKJV)
│   │
│   ├── types/                    # TypeScript types
│   │   ├── index.ts              # App-level types
│   │   ├── models.ts             # Domain models
│   │   └── database.types.ts     # Supabase generated types
│   │
│   ├── utils/                    # Utility functions (14 files)
│   │   ├── backgroundSync.ts     # Service worker sync
│   │   ├── calendarHelpers.ts    # Calendar date math
│   │   ├── countdownService.ts   # Timer calculations
│   │   ├── dateFormat.ts         # Date formatting
│   │   ├── dateFormatters.ts     # Additional formatters
│   │   ├── dateHelpers.ts        # Date utilities
│   │   ├── haptics.ts            # Vibration API wrapper
│   │   ├── interactionValidation.ts # Poke/kiss validation
│   │   ├── messageRotation.ts    # Daily message selection
│   │   ├── messageValidation.ts  # Message input validation
│   │   ├── moodEmojis.ts         # Mood→emoji mapping
│   │   ├── moodGrouping.ts       # Mood aggregation
│   │   ├── offlineErrorHandler.ts # Offline error UX
│   │   ├── performanceMonitoring.ts # Perf tracking
│   │   ├── storageMonitor.ts     # Quota monitoring
│   │   └── themes.ts             # Theme definitions
│   │
│   └── validation/               # Input validation
│       ├── index.ts              # Barrel export
│       ├── schemas.ts            # Zod input schemas
│       └── errorMessages.ts      # User-facing errors
│
├── supabase/                     # Supabase configuration
│   ├── config.toml               # Project config
│   ├── migrations/               # 8 SQL migrations
│   │   ├── 20251203000001_create_base_schema.sql
│   │   ├── 20251203190800_create_photos_table.sql
│   │   ├── 20251205000001_add_love_notes_images.sql
│   │   ├── 20251205000002_add_mime_validation.sql
│   │   ├── 20251206024345_remote_schema.sql
│   │   ├── 20251206124803_fix_users_rls_policy.sql
│   │   ├── 20251206200000_fix_users_update_privilege_escalation.sql
│   │   └── 20260128000001_scripture_reading.sql
│   ├── functions/
│   │   └── upload-love-note-image/  # Edge Function: image upload
│   └── snippets/
│
├── tests/                        # Test suite
│   ├── setup.ts                  # Global test setup
│   ├── support/                  # Test infrastructure
│   │   ├── factories/            # Test data factories
│   │   ├── fixtures/             # Playwright fixtures
│   │   ├── helpers/              # Test helpers
│   │   └── merged-fixtures.ts    # Combined fixtures
│   ├── e2e/                      # Playwright E2E (21 specs)
│   │   ├── auth/                 # Login, logout, OAuth, display name
│   │   ├── home/                 # Home view, error boundary, welcome
│   │   ├── mood/                 # Mood tracker
│   │   ├── navigation/           # Bottom nav, routing
│   │   ├── notes/                # Love notes chat
│   │   ├── offline/              # Data sync, network status
│   │   ├── partner/              # Partner mood
│   │   ├── photos/               # Gallery, upload
│   │   └── scripture/            # Overview, session, reflection, seeding
│   └── unit/                     # Vitest unit tests
│       ├── data/                 # Data file tests
│       ├── services/             # Service tests (dbSchema, scripture)
│       ├── stores/               # Store slice tests
│       └── utils/                # Utility tests
│
├── scripts/                      # Dev/CI scripts (9 files)
│   ├── burn-in.sh                # E2E burn-in test loop
│   ├── ci-local.sh               # Local CI simulation
│   ├── clear-caches.js           # Cache cleanup
│   ├── dev-with-cleanup.sh       # Dev server with cleanup
│   ├── test-with-cleanup.sh      # Test runner with cleanup
│   ├── post-deploy-check.cjs     # Post-deploy health check
│   ├── validate-messages.cjs     # Message validation
│   ├── fetch_comments.py         # PR comment fetcher
│   └── inspect-db.sh             # Database inspection
│
├── public/                       # Static assets
│   ├── icons/                    # PWA icons
│   ├── 404.html                  # GitHub Pages SPA fallback
│   └── vite.svg
│
├── .github/workflows/            # CI/CD pipelines (5 workflows)
│   ├── test.yml                  # Lint → Unit → E2E (sharded) → Burn-in
│   ├── deploy.yml                # Build → Smoke → Deploy → Health check
│   ├── supabase-migrations.yml   # Migration validation
│   ├── claude.yml                # AI assistance
│   └── claude-code-review.yml    # Automated code review
│
├── docs/                         # Project documentation (this folder)
├── _bmad/                        # BMAD framework config
├── _bmad-output/                 # BMAD planning artifacts
│
├── index.html                    # SPA entry point
├── vite.config.ts                # Vite config (manual chunks, PWA)
├── vitest.config.ts              # Unit test config
├── playwright.config.ts          # E2E test config
├── tsconfig.json                 # TypeScript config (project refs)
├── tsconfig.app.json             # App TypeScript config
├── tsconfig.node.json            # Node TypeScript config
├── tailwind.config.js            # Tailwind customization
├── postcss.config.js             # PostCSS plugins
├── eslint.config.js              # ESLint flat config
├── package.json                  # Dependencies + scripts
└── .nvmrc                        # Node.js 24.13.0
```

## Database Schema

| Table | Purpose | RLS |
|-------|---------|-----|
| `users` | User profiles, partner relationships | Yes |
| `moods` | Emoji mood entries with notes | Yes |
| `love_notes` | Chat messages between partners | Yes |
| `interactions` | Poke/kiss interactions | Yes |
| `partner_requests` | Partner connection workflow | Yes |
| `scripture_sessions` | Scripture reading sessions | Yes |
| `scripture_step_states` | Step-level progress tracking | Yes |
| `scripture_reflections` | User reflections on passages | Yes |
| `scripture_bookmarks` | Passage bookmarks | Yes |
| `scripture_messages` | Prayer/report messages | Yes |

## CI/CD Pipeline

| Workflow | Trigger | Purpose |
|----------|---------|---------|
| `test.yml` | Push/PR | Lint → Unit → E2E (sharded) → Burn-in |
| `deploy.yml` | Push to main | Build → Smoke → Deploy → Health check |
| `supabase-migrations.yml` | PR | Migration validation |
| `claude.yml` | Issue/PR | AI assistance |
| `claude-code-review.yml` | PR | Automated code review |

## Development Guide

### Prerequisites

- Node.js 24.13.0 (see `.nvmrc`)
- npm (comes with Node)
- Supabase CLI (`npm i -g supabase`)
- Playwright browsers (`npx playwright install`)

### Environment Setup

Copy `.env.example` to `.env` and fill in:
- `VITE_SUPABASE_URL` - Supabase project URL
- `VITE_SUPABASE_ANON_KEY` - Supabase anonymous key

Environment variables are managed via `dotenvx` for encrypted storage.

### Commands

```bash
# Development
npm run dev              # Dev server with cleanup (via script)
npm run dev:raw          # Raw Vite dev server
npm run preview          # Preview production build

# Build
npm run build            # TypeScript check + Vite build
npm run typecheck        # TypeScript only (no emit)

# Testing
npm run test:unit        # Vitest run (single pass)
npm run test:unit:watch  # Vitest watch mode
npm run test:unit:ui     # Vitest UI dashboard
npm run test:unit:coverage # Coverage report
npm run test:e2e         # Playwright with cleanup
npm run test:e2e:raw     # Raw Playwright
npm run test:e2e:ui      # Playwright UI mode
npm run test:e2e:debug   # Playwright debug mode
npm run test:smoke       # Post-build smoke tests
npm run test:burn-in     # E2E burn-in loop (stability)
npm run test:ci-local    # Full local CI simulation

# Code Quality
npm run lint             # ESLint check
npm run lint:fix         # ESLint + Prettier auto-fix
npm run format           # Prettier format all
npm run format:check     # Prettier check only

# Deployment
npm run deploy           # Build + smoke + deploy to GitHub Pages
```

### Test Architecture

- **Unit tests**: Vitest + Testing Library + happy-dom + fake-indexeddb
- **E2E tests**: Playwright with custom fixtures, factories, and helpers
- **TDD enforcement**: tdd-guard-vitest reporter
- **CI sharding**: E2E tests run in parallel shards
- **Burn-in**: Repeated E2E runs for stability validation

## Getting Started

```bash
nvm use                  # Switch to Node 24.13.0
npm ci                   # Install dependencies
cp .env.example .env     # Configure environment
npm run dev              # Start dev server
```

## Related Documentation

- [README.md](../README.md) - Project setup guide
- [Sprint Status](../_bmad-output/implementation-artifacts/sprint-status.yaml) - Current sprint progress
