<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>4</epicId>
    <storyId>4.5</storyId>
    <title>Photo Gallery Navigation Integration</title>
    <status>drafted</status>
    <generatedAt>2025-11-12</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/4-5-photo-gallery-navigation-integration.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>your girlfriend</asA>
    <iWant>seamless navigation between Home and Photos</iWant>
    <soThat>I can easily access my photo memories</soThat>
    <tasks>
      <task id="1" title="Create TopNavigation Component">
        <acs>4.5.1, 4.5.2</acs>
        <subtasks>
          <subtask id="1.1">Create component file src/components/TopNavigation/TopNavigation.tsx</subtask>
          <subtask id="1.2">Implement navigation bar layout (fixed header, flex row, 2 tabs)</subtask>
          <subtask id="1.3">Add Home tab with House icon (Lucide) and "Home" label</subtask>
          <subtask id="1.4">Add Photos tab with Camera icon (Lucide) and "Photos" label</subtask>
          <subtask id="1.5">Implement active tab highlighting (conditional styling based on currentView)</subtask>
          <subtask id="1.6">Add onClick handlers to call setView('home') and setView('photos')</subtask>
          <subtask id="1.7">Add ARIA attributes for accessibility (aria-label, aria-current)</subtask>
          <subtask id="1.8">Add data-testid attributes for E2E testing</subtask>
        </subtasks>
      </task>
      <task id="2" title="Extend Zustand Store with View State">
        <acs>4.5.2, 4.5.3, 4.5.5, 4.5.6</acs>
        <subtasks>
          <subtask id="2.1">Add currentView state to useAppStore ('home' | 'photos', default: 'home')</subtask>
          <subtask id="2.2">Add setView(view) action that updates currentView and calls pushState()</subtask>
          <subtask id="2.3">Add navigateHome() and navigatePhotos() convenience actions</subtask>
          <subtask id="2.4">Implement URL routing logic in setView (pushState with / or /photos)</subtask>
          <subtask id="2.5">Add popstate event listener to sync currentView on browser back/forward</subtask>
          <subtask id="2.6">Implement initial route detection on app mount (parse pathname, set initial view)</subtask>
        </subtasks>
      </task>
      <task id="3" title="Implement View Switching in App.tsx">
        <acs>4.5.3</acs>
        <subtasks>
          <subtask id="3.1">Import TopNavigation, DailyMessage, PhotoGallery components</subtask>
          <subtask id="3.2">Subscribe to currentView from Zustand store</subtask>
          <subtask id="3.3">Conditional rendering: {currentView === 'home' ? &lt;DailyMessage /&gt; : &lt;PhotoGallery /&gt;}</subtask>
          <subtask id="3.4">Add TopNavigation component above conditional view rendering</subtask>
          <subtask id="3.5">Optional: Add fade transition wrapper (Framer Motion AnimatePresence)</subtask>
          <subtask id="3.6">Test view switching (Home ↔ Photos) works correctly</subtask>
        </subtasks>
      </task>
      <task id="4" title="Implement Deep Linking and Browser History">
        <acs>4.5.5, 4.5.6</acs>
        <subtasks>
          <subtask id="4.1">Implement window.history.pushState() in setView() action</subtask>
          <subtask id="4.2">Add window.addEventListener('popstate') in App.tsx useEffect</subtask>
          <subtask id="4.3">Parse window.location.pathname on mount to set initial view</subtask>
          <subtask id="4.4">Handle unknown paths (redirect to Home or show 404 toast)</subtask>
          <subtask id="4.5">Test deep linking: Navigate directly to /photos, verify PhotoGallery loads</subtask>
          <subtask id="4.6">Test browser back/forward buttons, verify view syncs correctly</subtask>
        </subtasks>
      </task>
      <task id="5" title="Add Photo Count Badge" optional="true">
        <acs>4.5.4</acs>
        <subtasks>
          <subtask id="5.1">Create Badge component (small circle with number display)</subtask>
          <subtask id="5.2">Subscribe to photos.length from Zustand in TopNavigation</subtask>
          <subtask id="5.3">Conditionally render badge on Photos tab if photos.length &gt; 0</subtask>
          <subtask id="5.4">Position badge at top-right of Camera icon</subtask>
          <subtask id="5.5">Style badge (white text, primary background, 16px diameter)</subtask>
          <subtask id="5.6">Handle large counts (&gt; 99 show "99+")</subtask>
          <subtask id="5.7">Add aria-label with count for accessibility</subtask>
        </subtasks>
      </task>
      <task id="6" title="Style TopNavigation for Responsive Design">
        <acs>4.5.1, 4.5.2</acs>
        <subtasks>
          <subtask id="6.1">Mobile layout (&lt;640px): Icon-only tabs, no labels</subtask>
          <subtask id="6.2">Desktop layout (≥640px): Icons + labels below</subtask>
          <subtask id="6.3">Active tab styling: Primary color (blue-600), bold text, larger icon</subtask>
          <subtask id="6.4">Inactive tab styling: Muted color (gray-500), normal weight</subtask>
          <subtask id="6.5">Smooth transition on hover (200ms) and active state change</subtask>
          <subtask id="6.6">Ensure navigation bar fixed at top (z-index: 40, no scroll)</subtask>
        </subtasks>
      </task>
      <task id="7" title="Create E2E Test Suite for Navigation">
        <acs>All</acs>
        <subtasks>
          <subtask id="7.1">Create tests/e2e/navigation.spec.ts</subtask>
          <subtask id="7.2">Test: TopNavigation renders with Home and Photos tabs</subtask>
          <subtask id="7.3">Test: Click Photos tab, verify PhotoGallery displays and tab highlighted</subtask>
          <subtask id="7.4">Test: Click Home tab, verify DailyMessage displays and tab highlighted</subtask>
          <subtask id="7.5">Test: Deep linking - navigate to /photos directly, verify PhotoGallery loads</subtask>
          <subtask id="7.6">Test: Browser back button - Home → Photos → Back → returns to Home</subtask>
          <subtask id="7.7">Test: Browser forward button - redo navigation after back</subtask>
          <subtask id="7.8">Test: Photo count badge displays correct count (if implemented)</subtask>
          <subtask id="7.9">Test: Smooth transitions between views (no flash, no reload)</subtask>
          <subtask id="7.10">Test: Unknown paths redirect to Home or show 404</subtask>
        </subtasks>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="4.5.1" priority="required">
      <title>Top Navigation Bar Includes Photos Tab with Camera Icon</title>
      <description>Given app is loaded, When user views any screen, Then top navigation bar SHALL display Home and Photos tabs with icons</description>
      <requirements>
        <requirement>TopNavigation component renders as fixed header (z-index: 40, below modals)</requirement>
        <requirement>Home tab: House icon from Lucide (Home component)</requirement>
        <requirement>Photos tab: Camera icon from Lucide (Camera component)</requirement>
        <requirement>Tab labels: "Home" and "Photos" text below icons (or icon-only on mobile)</requirement>
        <requirement>Responsive design: Icons only on mobile (&lt;640px), icons + labels on desktop</requirement>
        <requirement>Accessible: aria-label for each tab ("Navigate to Home", "Navigate to Photos")</requirement>
        <requirement>Click/tap handlers: onClick triggers setView() Zustand action</requirement>
      </requirements>
    </criterion>
    <criterion id="4.5.2" priority="required">
      <title>Active Tab Highlighted to Show Current View</title>
      <description>Given user is on Home or Photos view, When view is active, Then corresponding tab SHALL be highlighted with visual indicator</description>
      <requirements>
        <requirement>Active tab styling: Primary color (blue-600), bold text, larger icon, or underline indicator</requirement>
        <requirement>Inactive tab styling: Muted color (gray-500), normal weight text</requirement>
        <requirement>State tracking: Zustand currentView state determines active tab</requirement>
        <requirement>Visual feedback: Smooth transition (200ms) when switching tabs</requirement>
        <requirement>Clear contrast: Active vs inactive state immediately recognizable</requirement>
        <requirement>Accessibility: aria-current="page" on active tab for screen readers</requirement>
      </requirements>
    </criterion>
    <criterion id="4.5.3" priority="required">
      <title>Navigation Transitions Smoothly Between Home and Photos</title>
      <description>Given user is on Home or Photos view, When user taps/clicks opposite tab, Then view SHALL transition smoothly without jarring page reloads</description>
      <requirements>
        <requirement>Instant view switching: No full page reload, just component swap</requirement>
        <requirement>Fade transition (optional): Fade out current view (200ms), fade in new view (200ms)</requirement>
        <requirement>State preservation: Switching views preserves app state (photos array, settings, etc.)</requirement>
        <requirement>No network requests: All data already loaded (offline-first)</requirement>
        <requirement>Scroll position reset: New view starts at top (scroll Y = 0)</requirement>
        <requirement>Performance: View switch completes in &lt; 100ms</requirement>
      </requirements>
    </criterion>
    <criterion id="4.5.4" priority="optional">
      <title>Photo Count Badge on Photos Tab (Optional Enhancement)</title>
      <description>Given user has uploaded photos, When viewing any screen, Then Photos tab MAY display photo count badge</description>
      <requirements>
        <requirement>Badge displays photos.length from Zustand photos state</requirement>
        <requirement>Position: Top-right corner of Photos tab icon</requirement>
        <requirement>Styling: Small circle (16px diameter), white text on primary color background</requirement>
        <requirement>Updates automatically: Reactively updates when photos added/deleted</requirement>
        <requirement>Only shows if &gt; 0 photos: Badge hidden if no photos uploaded</requirement>
        <requirement>Max display: If &gt; 99 photos, show "99+" to prevent overflow</requirement>
        <requirement>Accessible: aria-label includes count ("23 photos uploaded")</requirement>
      </requirements>
    </criterion>
    <criterion id="4.5.5" priority="required">
      <title>Deep Linking Supported - Direct URL Access to Photo Gallery</title>
      <description>Given user has direct link to photo gallery, When user navigates to /photos URL, Then app SHALL load with PhotoGallery view active</description>
      <requirements>
        <requirement>URL routing: / → Home view, /photos → Photo Gallery view</requirement>
        <requirement>Initial route detection: Parse window.location.pathname on app mount</requirement>
        <requirement>Set initial view: If pathname === '/photos', setView('photos') on mount</requirement>
        <requirement>Update browser history: setView() calls window.history.pushState() to update URL</requirement>
        <requirement>State consistency: currentView state matches URL pathname at all times</requirement>
        <requirement>Shareable links: /photos URL can be shared and works when opened in new tab</requirement>
        <requirement>404 handling: Unknown paths default to Home view (/), optionally show "not found" toast</requirement>
      </requirements>
    </criterion>
    <criterion id="4.5.6" priority="required">
      <title>Browser Back Button Works Correctly</title>
      <description>Given user has navigated between Home and Photos, When user clicks browser back button, Then app SHALL navigate to previous view</description>
      <requirements>
        <requirement>History management: Each setView() calls pushState() to add history entry</requirement>
        <requirement>popstate event listener: Listen for browser back/forward, sync currentView</requirement>
        <requirement>Correct navigation flow: Home → Photos → Back → Home, Photos → Home → Back → Photos</requirement>
        <requirement>State synchronization: popstate event updates Zustand currentView to match URL</requirement>
        <requirement>No broken states: View always matches URL pathname after navigation</requirement>
        <requirement>Forward button: Works correctly after back (redo navigation)</requirement>
      </requirements>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc source="docs/tech-spec-epic-4.md" sections="Story 4.5: Navigation Integration">
        **Story 4.5 Design (Navigation Integration):**
        - Top navigation bar with Home and Photos tabs
        - URL routing: / → Home view, /photos → Photo Gallery view
        - Browser History API integration (pushState, popstate)
        - Zustand store extension: currentView state ('home' | 'photos')
        - setView(view) action updates currentView and calls pushState()
        - Deep linking supported: direct /photos URL loads PhotoGallery
        - Browser back/forward buttons work correctly
        - No navigation library (React Router) - simple URL state management
      </doc>

      <doc source="docs/architecture.md" sections="Component Architecture, State Management">
        **Component-Based SPA Architecture:**
        - App (Root) → ErrorBoundary → Conditional View Rendering
        - No routing library - single-view SPA with conditional rendering
        - Pre-configuration pattern (constants.ts)
        - State: Zustand with persist middleware to LocalStorage

        **Current Architecture (Story 4.4 snapshot):**
        ```
        App.tsx
        ├── currentView state: 'home' | 'photos'
        ├── Conditional rendering:
        │   ├── {currentView === 'home' ? <DailyMessage /> : <PhotoGallery />}
        │   └── <BottomNavigation currentView={currentView} onViewChange={setCurrentView} />
        ```

        **Required Changes for Story 4.5:**
        - Replace App.tsx local state with Zustand global state
        - Add URL routing logic (pushState/popstate)
        - Move currentView state to Zustand store
        - Implement setView() action with browser history management
      </doc>

      <doc source="docs/state-management.md" sections="Store Architecture, State Slices">
        **Zustand Store Patterns:**
        - Single store: useAppStore (no store splitting)
        - Persist middleware: LocalStorage with partialize
        - State initialization: initializeApp() loads IndexedDB data
        - Action pattern: (set, get) => ({ state, actions })

        **Existing State Structure:**
        ```typescript
        interface AppState {
          settings: Settings | null;
          messages: Message[];
          photos: Photo[];
          selectedPhotoId: number | null; // Story 4.2
          // NEW: Story 4.5 adds currentView and routing actions
        }
        ```

        **State Update Pattern:**
        ```typescript
        set({ field: newValue }); // Simple update
        set((state) => ({ computed: state.field + 1 })); // Computed
        ```
      </doc>

      <doc source="docs/tech-spec-epic-4.md" sections="Workflows: Story 4.5 Navigation">
        **Critical Workflow: Photo Gallery Navigation (Story 4.5):**
        1. User clicks Photos tab in top navigation
        2. setView('photos') action called
        3. Zustand updates currentView state
        4. window.history.pushState() called with /photos URL
        5. App.tsx conditional render shows PhotoGallery
        6. Browser back button click → popstate event
        7. Event handler syncs currentView to URL pathname
        8. Conditional render switches back to Home

        **URL Routing Strategy:**
        - / → Home view (DailyMessage component)
        - /photos → Photos view (PhotoGallery component)
        - Unknown paths → Redirect to / (Home) or show 404 toast
      </doc>
    </docs>

    <code>
      <file path="src/App.tsx" relevance="CRITICAL - main modification target">
        **Current Implementation (Story 4.4):**
        - Line 49: Local state `currentView: 'home' | 'photos'`
        - Line 152-158: Conditional rendering based on currentView
        - Line 161: BottomNavigation with currentView prop
        - Uses local useState for view switching (pre-Story 4.5)

        **Required Changes:**
        - Remove local currentView state
        - Import currentView, setView from useAppStore
        - Add useEffect for popstate event listener
        - Add initial route detection on mount (parse pathname)
        - Update BottomNavigation to call setView action
      </file>

      <file path="src/stores/useAppStore.ts" relevance="CRITICAL - state extension target">
        **Current State (Story 4.4):**
        - Lines 46-54: Photo state (photos, selectedPhotoId, loading/error)
        - NO currentView state yet (Story 4.5 adds this)
        - NO routing actions yet (Story 4.5 adds these)

        **Required Additions:**
        ```typescript
        // State (add to AppState interface line ~29)
        currentView: 'home' | 'photos';

        // Actions (add to interface line ~63)
        setView: (view: 'home' | 'photos') => void;
        navigateHome: () => void;
        navigatePhotos: () => void;
        ```

        **Implementation Pattern:**
        ```typescript
        // In create() store function (line ~158)
        currentView: 'home', // Initial state

        setView: (view) => {
          set({ currentView: view });
          // Update browser history
          const url = view === 'home' ? '/' : '/photos';
          window.history.pushState({}, '', url);
        },

        navigateHome: () => get().setView('home'),
        navigatePhotos: () => get().setView('photos'),
        ```
      </file>

      <file path="src/components/PhotoGallery/PhotoGallery.tsx" relevance="REFERENCE - no changes needed">
        **Current Implementation:**
        - Lines 27-263: Fully implemented gallery component
        - Receives onUploadClick prop from App.tsx
        - Uses selectPhoto action for carousel navigation
        - No navigation logic (handled by App.tsx)
        - Story 4.5 does NOT modify this file
      </file>

      <file path="src/components/DailyMessage/DailyMessage.tsx" relevance="REFERENCE - no changes needed">
        **Current Implementation:**
        - Main home view component
        - Displays daily love message with animations
        - Receives onShowWelcome prop from App.tsx
        - No navigation logic (handled by App.tsx)
        - Story 4.5 does NOT modify this file
      </file>

      <file path="src/components/Navigation/BottomNavigation.tsx" relevance="MEDIUM - needs to be created">
        **Current Status:** Component exists (added in Story 4.1)
        - Renders Home and Photos tabs with icons
        - Receives currentView prop
        - Calls onViewChange callback when tab clicked
        - Story 4.5 will UPDATE to use Zustand setView action directly

        **Expected Interface:**
        ```typescript
        interface BottomNavigationProps {
          currentView: 'home' | 'photos';
          onViewChange: (view: 'home' | 'photos') => void;
        }
        ```
      </file>
    </code>

    <dependencies>
      <library name="zustand" version="5.0.8" usage="State management - extend store with currentView and routing actions">
        **Patterns Used:**
        - create() with persist middleware
        - Simple state updates via set()
        - Access previous state via get()
        - No selectors needed for currentView (simple string)
      </library>

      <library name="lucide-react" version="0.548.0" usage="Icons for navigation tabs (Home, Camera)">
        **Icons:**
        - Home icon (House component)
        - Photos icon (Camera component)
      </library>

      <api name="History API" type="Browser API" usage="URL routing without React Router">
        **Methods:**
        - window.history.pushState({}, '', url) - Update URL without reload
        - window.addEventListener('popstate', handler) - Listen for back/forward buttons
        - window.location.pathname - Parse current URL path

        **Pattern:**
        ```typescript
        // Update URL when view changes
        setView: (view) => {
          const url = view === 'home' ? '/' : '/photos';
          window.history.pushState({}, '', url);
          set({ currentView: view });
        };

        // Sync state on back/forward
        useEffect(() => {
          const handlePopState = () => {
            const path = window.location.pathname;
            const view = path === '/photos' ? 'photos' : 'home';
            set({ currentView: view }); // Sync without pushState
          };
          window.addEventListener('popstate', handlePopState);
          return () => window.removeEventListener('popstate', handlePopState);
        }, []);
        ```
      </api>

      <framework name="React" version="19.1.1" usage="Component rendering, hooks (useEffect for popstate)">
        **Hooks Used:**
        - useEffect(() => {}, []) - Initial route detection on mount
        - useEffect(() => {}, []) - popstate event listener setup
      </framework>

      <framework name="Tailwind CSS" version="3.4.18" usage="Styling for navigation bar (if created as new component)">
        **Utility Classes:**
        - Responsive design (sm:, lg: breakpoints)
        - Active tab styling (conditional classes)
        - Fixed positioning for top navigation
      </framework>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="architecture" priority="critical">
      No routing library (React Router) - Must use simple conditional rendering + History API
    </constraint>

    <constraint type="architecture" priority="critical">
      Zustand state must be source of truth - App.tsx local state removed
    </constraint>

    <constraint type="performance" priority="high">
      View switching must be instant (<100ms) - No network requests, just component swap
    </constraint>

    <constraint type="compatibility" priority="high">
      History API popstate events - Must work correctly in Safari (known Safari quirks)
    </constraint>

    <constraint type="state" priority="high">
      currentView NOT persisted to LocalStorage - Always reset to 'home' on app restart
    </constraint>

    <constraint type="url" priority="medium">
      Base path /My-Love/ (GitHub Pages deployment) - Must handle base path correctly in routing
    </constraint>

    <constraint type="offline" priority="medium">
      All navigation must work offline - No backend routing, purely client-side
    </constraint>

    <constraint type="testing" priority="medium">
      E2E tests must verify History API integration - Use Playwright browser back/forward APIs
    </constraint>
  </constraints>

  <interfaces>
    <interface type="Zustand Store Extension">
      ```typescript
      // Add to AppState interface (src/stores/useAppStore.ts)
      interface AppState {
        // ... existing state ...

        // Story 4.5: Navigation state
        currentView: 'home' | 'photos';

        // Story 4.5: Navigation actions
        setView: (view: 'home' | 'photos') => void;
        navigateHome: () => void;
        navigatePhotos: () => void;
      }
      ```
    </interface>

    <interface type="App.tsx Modifications">
      ```typescript
      // Remove local state
      // const [currentView, setCurrentView] = useState<'home' | 'photos'>('home');

      // Import from Zustand
      const { currentView, setView } = useAppStore();

      // Add initial route detection
      useEffect(() => {
        const path = window.location.pathname;
        const initialView = path.includes('/photos') ? 'photos' : 'home';
        setView(initialView);
      }, [setView]);

      // Add popstate listener
      useEffect(() => {
        const handlePopState = () => {
          const path = window.location.pathname;
          const view = path.includes('/photos') ? 'photos' : 'home';
          setView(view);
        };
        window.addEventListener('popstate', handlePopState);
        return () => window.removeEventListener('popstate', handlePopState);
      }, [setView]);

      // Conditional render (no changes)
      {currentView === 'home' && <DailyMessage />}
      {currentView === 'photos' && <PhotoGallery />}
      ```
    </interface>

    <interface type="TopNavigation Component (NEW)" optional="true">
      ```typescript
      // NEW COMPONENT: src/components/TopNavigation/TopNavigation.tsx
      interface TopNavigationProps {
        // No props needed - reads from Zustand directly
      }

      export function TopNavigation() {
        const { currentView, setView } = useAppStore();

        return (
          <nav className="fixed top-0 left-0 right-0 z-40 bg-white shadow-sm">
            <div className="flex justify-center gap-4 p-4">
              <button
                onClick={() => setView('home')}
                className={currentView === 'home' ? 'active' : ''}
                aria-label="Navigate to Home"
                aria-current={currentView === 'home' ? 'page' : undefined}
              >
                <Home className="w-6 h-6" />
                <span>Home</span>
              </button>

              <button
                onClick={() => setView('photos')}
                className={currentView === 'photos' ? 'active' : ''}
                aria-label="Navigate to Photos"
                aria-current={currentView === 'photos' ? 'page' : undefined}
              >
                <Camera className="w-6 h-6" />
                <span>Photos</span>
              </button>
            </div>
          </nav>
        );
      }
      ```
    </interface>
  </interfaces>

  <tests>
    <standards>
      - **Test Framework**: Playwright E2E tests (@playwright/test ^1.56.1)
      - **Test File**: tests/e2e/navigation.spec.ts (NEW)
      - **Browser Coverage**: Chromium, Firefox, WebKit (3 browsers)
      - **Assertion Library**: Playwright expect assertions
      - **Test Pattern**: Arrange → Act → Assert with page.goto(), page.click(), page.goBack()
    </standards>

    <locations>
      - **New Test Suite**: tests/e2e/navigation.spec.ts
      - **Test Helpers**: tests/support/helpers/navigationHelpers.ts (optional)
      - **Fixtures**: None needed (uses actual browser navigation APIs)
    </locations>

    <ideas>
      <test id="4.5.1" priority="critical" ac="AC-4.5.1">
        **Test: TopNavigation renders with Home and Photos tabs**
        - Arrange: Load app at /
        - Act: Check for navigation bar
        - Assert: Home tab visible, Photos tab visible, Camera icon present
        - data-testid: top-navigation, home-tab, photos-tab
      </test>

      <test id="4.5.2" priority="critical" ac="AC-4.5.2">
        **Test: Active tab highlighted correctly**
        - Arrange: Load app at /
        - Assert: Home tab has active styling (aria-current="page")
        - Act: Click Photos tab
        - Assert: Photos tab has active styling, Home tab inactive
        - Visual: Check for color change (blue-600 vs gray-500)
      </test>

      <test id="4.5.3" priority="critical" ac="AC-4.5.3">
        **Test: Navigation transitions smoothly without page reloads**
        - Arrange: Load app at /, add page.on('load') listener to detect reloads
        - Act: Click Photos tab
        - Assert: PhotoGallery displays, NO page reload event fired
        - Act: Click Home tab
        - Assert: DailyMessage displays, NO page reload event fired
        - Performance: Transition completes in <100ms
      </test>

      <test id="4.5.4" priority="optional" ac="AC-4.5.4">
        **Test: Photo count badge displays on Photos tab**
        - Arrange: Upload 5 photos
        - Assert: Photos tab shows badge with "5"
        - Act: Upload 1 more photo
        - Assert: Badge updates to "6"
        - Edge case: Test "99+" display for >99 photos
      </test>

      <test id="4.5.5" priority="critical" ac="AC-4.5.5">
        **Test: Deep linking - direct URL access to /photos**
        - Arrange: Navigate to http://localhost:5173/My-Love/photos directly
        - Assert: PhotoGallery displays (not Home)
        - Assert: Photos tab has active styling
        - Assert: URL pathname === '/My-Love/photos'
      </test>

      <test id="4.5.6" priority="critical" ac="AC-4.5.6">
        **Test: Browser back button works correctly**
        - Arrange: Load app at / (Home view)
        - Act: Click Photos tab
        - Assert: PhotoGallery displays, URL === '/My-Love/photos'
        - Act: page.goBack() (browser back button)
        - Assert: DailyMessage displays, URL === '/My-Love/'
        - Act: page.goForward() (browser forward button)
        - Assert: PhotoGallery displays, URL === '/My-Love/photos'
      </test>

      <test id="4.5.7" priority="medium">
        **Test: Unknown paths redirect to Home**
        - Arrange: Navigate to http://localhost:5173/My-Love/invalid-path
        - Assert: DailyMessage displays (redirected to Home)
        - Assert: URL pathname === '/My-Love/' OR toast shows "Page not found"
      </test>

      <test id="4.5.8" priority="medium">
        **Test: Navigation state NOT persisted across sessions**
        - Arrange: Navigate to /photos
        - Act: Hard refresh (page.reload())
        - Assert: DailyMessage displays (reset to Home view)
        - Rationale: currentView NOT in partialize() - always reset to 'home'
      </test>

      <test id="4.5.9" priority="low">
        **Test: Smooth transitions with fade animation (optional)**
        - Arrange: Load app at /
        - Act: Click Photos tab
        - Assert: Fade-in animation visible (Framer Motion AnimatePresence)
        - Visual test: Check for opacity transition (200ms)
      </test>

      <test id="4.5.10" priority="medium">
        **Test: Navigation while carousel is open**
        - Arrange: Navigate to /photos, open carousel
        - Act: Click Home tab
        - Assert: Carousel closes, DailyMessage displays
        - Edge case: Verify selectedPhotoId cleared when navigating away
      </test>
    </ideas>
  </tests>
</story-context>
