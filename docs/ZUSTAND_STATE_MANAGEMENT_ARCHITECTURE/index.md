# Zustand State Management Architecture

## Table of Contents

- [Zustand State Management Architecture](#table-of-contents)
  - [Executive Summary](./executive-summary.md)
    - [Key Characteristics](./executive-summary.md#key-characteristics)
  - [Table of Contents](./table-of-contents.md)
  - [Store Architecture Overview](./store-architecture-overview.md)
    - [High-Level Architecture Diagram](./store-architecture-overview.md#high-level-architecture-diagram)
    - [AppState Interface](./store-architecture-overview.md#appstate-interface)
  - [Composition Pattern](./composition-pattern.md)
    - [Store Creation](./composition-pattern.md#store-creation)
    - [StateCreator Pattern](./composition-pattern.md#statecreator-pattern)
    - [Type Safety Note](./composition-pattern.md#type-safety-note)
  - [Persistence Strategy](./persistence-strategy.md)
    - [Storage Configuration](./persistence-strategy.md#storage-configuration)
    - [LocalStorage Persistence Configuration](./persistence-strategy.md#localstorage-persistence-configuration)
    - [Serialization & Deserialization](./persistence-strategy.md#serialization-deserialization)
      - [MessageHistory Map Serialization](./persistence-strategy.md#messagehistory-map-serialization)
    - [Pre-Hydration Validation](./persistence-strategy.md#pre-hydration-validation)
    - [Validation Logic](./persistence-strategy.md#validation-logic)
    - [Hydration Recovery](./persistence-strategy.md#hydration-recovery)
  - [Core Shared State](./core-shared-state.md)
    - [isLoading: boolean](./core-shared-state.md#isloading-boolean)
    - [error: string | null](./core-shared-state.md#error-string-null)
    - [\_\_isHydrated: boolean (Internal)](./core-shared-state.md#ishydrated-boolean-internal)
  - [Slice Specifications](./slice-specifications.md)
  - [SETTINGS SLICE](./settings-slice.md)
    - [File](./settings-slice.md#file)
    - [Purpose](./settings-slice.md#purpose)
    - [State Interface](./settings-slice.md#state-interface)
    - [State Shape](./settings-slice.md#state-shape)
    - [Initial State](./settings-slice.md#initial-state)
    - [Actions](./settings-slice.md#actions)
      - [initializeApp()](./settings-slice.md#initializeapp)
      - [setSettings(settings)](./settings-slice.md#setsettingssettings)
      - [updateSettings(updates)](./settings-slice.md#updatesettingsupdates)
      - [setOnboarded(onboarded)](./settings-slice.md#setonboardedonboarded)
      - [addAnniversary(anniversary)](./settings-slice.md#addanniversaryanniversary)
      - [removeAnniversary(id)](./settings-slice.md#removeanniversaryid)
    - [Validation](./settings-slice.md#validation)
    - [Persistence](./settings-slice.md#persistence)
    - [Dependencies](./settings-slice.md#dependencies)
  - [MESSAGES SLICE](./messages-slice.md)
    - [File](./messages-slice.md#file)
    - [Purpose](./messages-slice.md#purpose)
    - [State Interface](./messages-slice.md#state-interface)
    - [State Shape](./messages-slice.md#state-shape)
    - [Initial State](./messages-slice.md#initial-state)
    - [Actions](./messages-slice.md#actions)
      - [loadMessages()](./messages-slice.md#loadmessages)
      - [addMessage(text, category)](./messages-slice.md#addmessagetext-category)
      - [toggleFavorite(messageId)](./messages-slice.md#togglefavoritemessageid)
      - [updateCurrentMessage()](./messages-slice.md#updatecurrentmessage)
      - [navigateToPreviousMessage()](./messages-slice.md#navigatetopreviousmessage)
      - [navigateToNextMessage()](./messages-slice.md#navigatetonextmessage)
      - [canNavigateBack()](./messages-slice.md#cannavigateback)
      - [canNavigateForward()](./messages-slice.md#cannavigateforward)
      - [loadCustomMessages()](./messages-slice.md#loadcustommessages)
      - [createCustomMessage(input)](./messages-slice.md#createcustommessageinput)
      - [updateCustomMessage(input)](./messages-slice.md#updatecustommessageinput)
      - [deleteCustomMessage(id)](./messages-slice.md#deletecustommessageid)
      - [getCustomMessages(filter?)](./messages-slice.md#getcustommessagesfilter)
      - [exportCustomMessages()](./messages-slice.md#exportcustommessages)
      - [importCustomMessages(file)](./messages-slice.md#importcustommessagesfile)
    - [Message Rotation Pool](./messages-slice.md#message-rotation-pool)
    - [Persistence](./messages-slice.md#persistence)
    - [Dependencies](./messages-slice.md#dependencies)
  - [PHOTOS SLICE](./photos-slice.md)
    - [File](./photos-slice.md#file)
    - [Purpose](./photos-slice.md#purpose)
    - [State Interface](./photos-slice.md#state-interface)
    - [State Shape](./photos-slice.md#state-shape)
    - [Initial State](./photos-slice.md#initial-state)
    - [Actions](./photos-slice.md#actions)
      - [loadPhotos()](./photos-slice.md#loadphotos)
      - [uploadPhoto(input)](./photos-slice.md#uploadphotoinput)
      - [getPhotoById(photoId)](./photos-slice.md#getphotobyidphotoid)
      - [getStorageUsage()](./photos-slice.md#getstorageusage)
      - [clearStorageWarning()](./photos-slice.md#clearstoragewarning)
      - [updatePhoto(photoId, updates)](./photos-slice.md#updatephotophotoid-updates)
      - [deletePhoto(photoId)](./photos-slice.md#deletephotophotoid)
      - [selectPhoto(photoId)](./photos-slice.md#selectphotophotoid)
      - [clearPhotoSelection()](./photos-slice.md#clearphotoselection)
    - [Storage Quota Management](./photos-slice.md#storage-quota-management)
    - [Persistence](./photos-slice.md#persistence)
    - [Dependencies](./photos-slice.md#dependencies)
  - [MOOD SLICE](./mood-slice.md)
    - [File](./mood-slice.md#file)
    - [Purpose](./mood-slice.md#purpose)
    - [State Interface](./mood-slice.md#state-interface)
    - [State Shape](./mood-slice.md#state-shape)
    - [Initial State](./mood-slice.md#initial-state)
    - [Actions](./mood-slice.md#actions)
      - [addMoodEntry(moods, note?)](./mood-slice.md#addmoodentrymoods-note)
      - [getMoodForDate(date)](./mood-slice.md#getmoodfordatedate)
      - [updateMoodEntry(date, moods, note?)](./mood-slice.md#updatemoodentrydate-moods-note)
      - [loadMoods()](./mood-slice.md#loadmoods)
      - [updateSyncStatus()](./mood-slice.md#updatesyncstatus)
      - [syncPendingMoods()](./mood-slice.md#syncpendingmoods)
      - [fetchPartnerMoods(limit?)](./mood-slice.md#fetchpartnermoodslimit)
      - [getPartnerMoodForDate(date)](./mood-slice.md#getpartnermoodfordatedate)
    - [Mood Entry Schema](./mood-slice.md#mood-entry-schema)
    - [Sync Strategy](./mood-slice.md#sync-strategy)
    - [Persistence](./mood-slice.md#persistence)
    - [Dependencies](./mood-slice.md#dependencies)
  - [PARTNER SLICE](./partner-slice.md)
    - [File](./partner-slice.md#file)
    - [Purpose](./partner-slice.md#purpose)
    - [State Interface](./partner-slice.md#state-interface)
    - [State Shape](./partner-slice.md#state-shape)
    - [Initial State](./partner-slice.md#initial-state)
    - [Actions](./partner-slice.md#actions)
      - [loadPartner()](./partner-slice.md#loadpartner)
      - [loadPendingRequests()](./partner-slice.md#loadpendingrequests)
      - [searchUsers(query)](./partner-slice.md#searchusersquery)
      - [clearSearch()](./partner-slice.md#clearsearch)
      - [sendPartnerRequest(toUserId)](./partner-slice.md#sendpartnerrequesttouserid)
      - [acceptPartnerRequest(requestId)](./partner-slice.md#acceptpartnerrequestrequestid)
      - [declinePartnerRequest(requestId)](./partner-slice.md#declinepartnerrequestrequestid)
      - [hasPartner()](./partner-slice.md#haspartner)
    - [Persistence](./partner-slice.md#persistence)
    - [Dependencies](./partner-slice.md#dependencies)
  - [INTERACTIONS SLICE](./interactions-slice.md)
    - [File](./interactions-slice.md#file)
    - [Purpose](./interactions-slice.md#purpose)
    - [State Interface](./interactions-slice.md#state-interface)
    - [State Shape](./interactions-slice.md#state-shape)
    - [Initial State](./interactions-slice.md#initial-state)
    - [Actions](./interactions-slice.md#actions)
      - [sendPoke(partnerId)](./interactions-slice.md#sendpokepartnerid)
      - [sendKiss(partnerId)](./interactions-slice.md#sendkisspartnerid)
      - [markInteractionViewed(id)](./interactions-slice.md#markinteractionviewedid)
      - [getUnviewedInteractions()](./interactions-slice.md#getunviewedinteractions)
      - [getInteractionHistory(days?)](./interactions-slice.md#getinteractionhistorydays)
      - [loadInteractionHistory(limit?)](./interactions-slice.md#loadinteractionhistorylimit)
      - [subscribeToInteractions()](./interactions-slice.md#subscribetointeractions)
      - [addIncomingInteraction(record)](./interactions-slice.md#addincominginteractionrecord)
    - [Conversion Function](./interactions-slice.md#conversion-function)
    - [Validation](./interactions-slice.md#validation)
    - [Persistence](./interactions-slice.md#persistence)
    - [Real-time Architecture](./interactions-slice.md#real-time-architecture)
    - [Dependencies](./interactions-slice.md#dependencies)
  - [NAVIGATION SLICE](./navigation-slice.md)
    - [File](./navigation-slice.md#file)
    - [Purpose](./navigation-slice.md#purpose)
    - [State Interface](./navigation-slice.md#state-interface)
    - [State Shape](./navigation-slice.md#state-shape)
    - [Initial State](./navigation-slice.md#initial-state)
    - [Actions](./navigation-slice.md#actions)
      - [setView(view, skipHistory?)](./navigation-slice.md#setviewview-skiphistory)
      - [navigateHome()](./navigation-slice.md#navigatehome)
      - [navigatePhotos()](./navigation-slice.md#navigatephotos)
      - [navigateMood()](./navigation-slice.md#navigatemood)
      - [navigatePartner()](./navigation-slice.md#navigatepartner)
    - [Browser History Integration](./navigation-slice.md#browser-history-integration)
    - [Persistence](./navigation-slice.md#persistence)
    - [Dependencies](./navigation-slice.md#dependencies)
  - [Cross-Slice Dependencies](./cross-slice-dependencies.md)
    - [Dependency Graph](./cross-slice-dependencies.md#dependency-graph)
    - [Critical Dependencies](./cross-slice-dependencies.md#critical-dependencies)
      - [Settings → Messages](./cross-slice-dependencies.md#settings-messages)
      - [Messages → Settings](./cross-slice-dependencies.md#messages-settings)
    - [No Circular Dependencies](./cross-slice-dependencies.md#no-circular-dependencies)
    - [Optional Dependencies](./cross-slice-dependencies.md#optional-dependencies)
  - [Performance Optimizations](./performance-optimizations.md)
    - [1. Memoization & Selectors](./performance-optimizations.md#1-memoization-selectors)
    - [2. Partialize Middleware](./performance-optimizations.md#2-partialize-middleware)
    - [3. Async Load-on-Demand](./performance-optimizations.md#3-async-load-on-demand)
    - [4. Map vs Array for Message History](./performance-optimizations.md#4-map-vs-array-for-message-history)
    - [5. Filtering Rotation Pool](./performance-optimizations.md#5-filtering-rotation-pool)
    - [6. Optimistic UI Updates](./performance-optimizations.md#6-optimistic-ui-updates)
    - [7. Batch Operations](./performance-optimizations.md#7-batch-operations)
    - [8. Validation Caching](./performance-optimizations.md#8-validation-caching)
  - [Error Handling & Recovery](./error-handling-recovery.md)
    - [Error Categories](./error-handling-recovery.md#error-categories)
    - [Hydration Failure Recovery](./error-handling-recovery.md#hydration-failure-recovery)
    - [Validation Failure Recovery](./error-handling-recovery.md#validation-failure-recovery)
    - [IndexedDB Failure Recovery](./error-handling-recovery.md#indexeddb-failure-recovery)
    - [Initialization Guard: Double-Check](./error-handling-recovery.md#initialization-guard-double-check)
  - [Initialization Sequence](./initialization-sequence.md)
    - [App Startup Flow](./initialization-sequence.md#app-startup-flow)
    - [Timing Details](./initialization-sequence.md#timing-details)
    - [State During Initialization](./initialization-sequence.md#state-during-initialization)
    - [Error During Initialization](./initialization-sequence.md#error-during-initialization)
  - [Summary Statistics](./summary-statistics.md)
    - [Store Complexity](./summary-statistics.md#store-complexity)
    - [Slice Breakdown](./summary-statistics.md#slice-breakdown)
    - [Persistence Breakdown](./summary-statistics.md#persistence-breakdown)
  - [Conclusion](./conclusion.md)
