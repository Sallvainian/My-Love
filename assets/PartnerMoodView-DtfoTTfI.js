import{j as e,A as q,m as v}from"./vendor-animation-Gbi4aw9F.js";import{r as a}from"./vendor-state-B7YfVSdG.js";import{c as f,u as G,P as Q,U as W,X,R as J,b as K,d as Z,S as ee,a as te,H as se}from"./index-CYs3EsE7.js";import{S as ae}from"./search-9CJ9h8-W.js";import{M as ne,a as re}from"./message-circle-ThlgSiwl.js";import"./vendor-react-DyfnzrEv.js";import"./vendor-supabase-Bty1Idrm.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],le=f("bell",ie);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],ce=f("check",oe);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],me=f("user-plus",de);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],he=f("wifi-off",xe);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],ge=f("wifi",pe),F={loved:{icon:se,label:"Loved",color:"text-red-500"},happy:{icon:te,label:"Happy",color:"text-yellow-500"},content:{icon:re,label:"Content",color:"text-blue-500"},thoughtful:{icon:ne,label:"Thoughtful",color:"text-purple-500"},grateful:{icon:ee,label:"Grateful",color:"text-pink-500"}};function ke(){const{partnerMoods:p,fetchPartnerMoods:c,syncStatus:r,partner:i,isLoadingPartner:g,sentRequests:u,receivedRequests:b,searchResults:l,isSearching:y,loadPartner:k,loadPendingRequests:S,searchUsers:R,clearSearch:M,sendPartnerRequest:_,acceptPartnerRequest:C,declinePartnerRequest:D}=G(),[d,P]=a.useState(!1),[E,N]=a.useState(null),[j,O]=a.useState({show:!1,mood:""}),[m,x]=a.useState("disconnected"),[o,U]=a.useState(""),[$,h]=a.useState(null);a.useEffect(()=>{r.isOnline&&(k(),S())},[r.isOnline,k,S]),a.useEffect(()=>{r.isOnline&&i&&L()},[i]),a.useEffect(()=>{if(!r.isOnline){x("disconnected");return}const t=[];let s=null;return(async()=>{s=await Z.subscribeMoodUpdates(n=>{const V=F[n.mood_type]?.label||n.mood_type;O({show:!0,mood:V,note:n.note||void 0});const B=setTimeout(()=>{O({show:!1,mood:""})},5e3);t.push(B),c(30).catch(Y=>{console.error("[PartnerMoodView] Failed to refresh after realtime update:",Y)})},n=>{n==="SUBSCRIBED"?x("connected"):n==="CHANNEL_ERROR"||n==="CLOSED"?x("disconnected"):n==="TIMED_OUT"&&x("reconnecting")})})().catch(n=>{console.error("[PartnerMoodView] Failed to setup subscription:",n),x("disconnected")}),()=>{t.forEach(n=>clearTimeout(n)),x("disconnected"),s&&s()}},[r.isOnline,c]);const L=a.useCallback(async()=>{if(!r.isOnline){N("Cannot fetch moods while offline");return}try{P(!0),N(null),await c(30)}catch(t){console.error("[PartnerMoodView] Failed to fetch partner moods:",t),N("Failed to load partner moods. Please try again.")}finally{P(!1)}},[r.isOnline,c]),T=a.useCallback(t=>{const s=new Date(t),w=new Date,n=new Date(w);return n.setDate(n.getDate()-1),s.toDateString()===w.toDateString()?"Today":s.toDateString()===n.toDateString()?"Yesterday":s.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})},[]);a.useEffect(()=>{const t=setTimeout(()=>{o.trim().length>=2?R(o):o.trim().length===0&&M()},300);return()=>clearTimeout(t)},[o,R,M]);const A=a.useCallback(t=>{U(t)},[]),I=a.useCallback(async t=>{try{h(null),await _(t),U("")}catch(s){h(s instanceof Error?s.message:"Failed to send partner request")}},[_]),z=a.useCallback(async t=>{try{h(null),await C(t)}catch(s){h(s instanceof Error?s.message:"Failed to accept partner request")}},[C]),H=a.useCallback(async t=>{try{h(null),await D(t)}catch(s){h(s instanceof Error?s.message:"Failed to decline partner request")}},[D]);return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20","data-testid":"partner-mood-view",children:[e.jsx(q,{children:j.show&&e.jsx(v.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 max-w-md w-full mx-4","data-testid":"partner-mood-notification",children:e.jsxs("div",{className:"bg-pink-500 text-white px-6 py-4 rounded-lg shadow-lg flex items-center gap-3",children:[e.jsx(le,{className:"w-5 h-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-semibold",children:[Q," just logged a mood: ",j.mood]}),j.note&&e.jsx("p",{className:"text-sm text-pink-100 mt-1 line-clamp-2",children:j.note})]})]})})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-6",children:[$&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800","data-testid":"partner-connection-error",children:$}),!i&&!g&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(W,{className:"w-16 h-16 mx-auto mb-4 text-pink-500"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Connect with Your Partner"}),e.jsx("p",{className:"text-gray-600",children:"Search for your partner to start sharing moods"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("label",{htmlFor:"partner-search",className:"block text-sm font-medium text-gray-700 mb-2",children:"Search by email or display name"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"partner-search",type:"text",value:o,onChange:t=>A(t.target.value),placeholder:"Enter email or name...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent","data-testid":"partner-search-input"})]}),y&&e.jsx("div",{className:"mt-4 text-center text-gray-500",children:e.jsx("div",{className:"animate-pulse",children:"Searching..."})}),!y&&l.length>0&&e.jsx("div",{className:"mt-4 space-y-2","data-testid":"partner-search-results",children:l.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.displayName}),e.jsx("p",{className:"text-sm text-gray-500",children:t.email})]}),e.jsxs("button",{onClick:()=>I(t.id),className:"flex items-center gap-2 px-4 py-2 bg-pink-500 hover:bg-pink-600 text-white rounded-lg font-medium transition-colors","data-testid":`send-request-${t.id}`,children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:"Send Request"})]})]},t.id))}),!y&&o.trim().length>=2&&l.length===0&&e.jsxs("div",{className:"mt-4 text-center text-gray-500",children:['No users found matching "',o,'"']})]}),u.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Sent Requests"}),e.jsx("div",{className:"space-y-2","data-testid":"sent-requests-list",children:u.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.to_user_display_name||t.to_user_email||"Unknown User"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Sent ",new Date(t.created_at).toLocaleDateString()]})]}),e.jsx("div",{className:"text-yellow-700 font-medium",children:"Pending"})]},t.id))})]}),b.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Received Requests"}),e.jsx("div",{className:"space-y-2","data-testid":"received-requests-list",children:b.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.from_user_display_name||t.from_user_email||"Unknown User"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Sent ",new Date(t.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>z(t.id),className:"flex items-center gap-1 px-3 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors","data-testid":`accept-request-${t.id}`,children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:"Accept"})]}),e.jsxs("button",{onClick:()=>H(t.id),className:"flex items-center gap-1 px-3 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors","data-testid":`decline-request-${t.id}`,children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"Decline"})]})]})]},t.id))})]})]}),g&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4 animate-pulse",children:"ðŸ’•"}),e.jsx("p",{className:"text-gray-600",children:"Loading partner information..."})]}),i&&!g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[i.displayName,"'s Moods"]}),r.isOnline&&e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium ${m==="connected"?"bg-green-100 text-green-700":m==="reconnecting"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-500"}`,"data-testid":"realtime-connection-status",title:m==="connected"?"Real-time updates active":m==="reconnecting"?"Reconnecting...":"Disconnected",children:[m==="connected"?e.jsx(ge,{className:"w-3 h-3"}):e.jsx(he,{className:"w-3 h-3"}),e.jsx("span",{className:"capitalize",children:m})]})]}),e.jsxs("p",{className:"text-gray-600",children:["Connected with ",i.displayName]})]}),e.jsxs("button",{onClick:L,disabled:d||!r.isOnline,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${d||!r.isOnline?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-pink-500 hover:bg-pink-600 text-white"}`,"data-testid":"partner-mood-refresh-button",children:[e.jsx(J,{className:`w-4 h-4 ${d?"animate-spin":""}`}),e.jsx("span",{children:d?"Refreshing...":"Refresh"})]})]}),E&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800","data-testid":"partner-mood-error",children:E}),!r.isOnline&&e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-yellow-800","data-testid":"partner-mood-offline-notice",children:"You're offline. Partner moods will load when you reconnect."}),d&&p.length===0&&e.jsxs("div",{className:"text-center py-12","data-testid":"partner-mood-loading",children:[e.jsx("div",{className:"text-6xl mb-4 animate-pulse",children:"ðŸ’•"}),e.jsx("p",{className:"text-gray-600",children:"Loading partner moods..."})]}),!d&&p.length===0&&e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-12","data-testid":"partner-mood-empty-state",children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No moods yet"}),e.jsxs("p",{className:"text-gray-500 mb-6",children:[i.displayName," hasn't logged any moods yet.",r.isOnline&&e.jsx(e.Fragment,{children:" Try refreshing to check for updates."})]})]}),p.length>0&&e.jsx("div",{className:"space-y-4","data-testid":"partner-mood-list",children:e.jsx(q,{children:p.map((t,s)=>e.jsx(ue,{moodEntry:t,formatDate:T},t.supabaseId||`${t.date}-${s}`))})})]})]})]})}const ue=a.memo(function({moodEntry:c,formatDate:r}){const{mood:i,date:g,note:u,timestamp:b}=c,l=F[i],y=l.icon;return e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow","data-testid":"partner-mood-card",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`${l.color} mt-1`,children:e.jsx(y,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-900",children:l.label}),e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:r(g)})]}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(b).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})})]}),u&&e.jsx("p",{className:"text-gray-700 text-sm leading-relaxed",children:u})]})]})})});export{ke as PartnerMoodView};
