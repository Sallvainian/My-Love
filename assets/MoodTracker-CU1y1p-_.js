import{j as e,m as b,A as I}from"./vendor-animation-DThAvwGe.js";import{r as a}from"./vendor-state-B7YfVSdG.js";import{c as $,a as _,S as H,b as R,H as P,X,m as Z,u as Q,d as ee,i as te}from"./index-CDCWL2mH.js";import{B,U as G,A as q,F as U,M as Y,a as z}from"./user-minus-p8N_is42.js";import"./vendor-react-DyfnzrEv.js";import"./vendor-supabase-Bty1Idrm.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ae=$("chevron-left",oe);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],se=$("chevron-right",ne);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],ie=$("circle-check-big",re);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]],ce=$("cloud-off",le);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],ue=$("cloud",de);function V({mood:t,icon:o,label:n,isSelected:u,onClick:c}){return e.jsxs(b.button,{onClick:c,whileHover:{scale:1.05},whileTap:{scale:.95},animate:{scale:u?1.1:1,backgroundColor:u?"rgba(236, 72, 153, 0.1)":"rgba(243, 244, 246, 1)"},transition:{type:"spring",stiffness:300,damping:20},className:`flex flex-col items-center justify-center gap-2 p-4 rounded-2xl border-2 transition-colors ${u?"border-pink-500 text-pink-500":"border-gray-200 text-gray-400 hover:border-gray-300 hover:text-gray-600"}`,"data-testid":`mood-button-${t}`,"aria-label":`${n} mood`,"aria-pressed":u,children:[e.jsx(o,{className:"w-8 h-8"}),e.jsx("span",{className:"text-sm font-medium",children:n})]})}function me(t,o){return new Date(t,o+1,0).getDate()}function ge(t,o){return new Date(t,o,1).getDay()}function xe(t,o){const n=me(t,o),u=ge(t,o),c=new Date,g=c.getFullYear(),p=c.getMonth(),m=c.getDate(),l=[];for(let r=0;r<u;r++)l.push({date:null,dayNumber:null,isToday:!1,isCurrentMonth:!1});for(let r=1;r<=n;r++){const x=new Date(t,o,r),j=t===g&&o===p&&r===m;l.push({date:x,dayNumber:r,isToday:j,isCurrentMonth:!0})}return l}function he(t){const o=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),u=String(t.getDate()).padStart(2,"0");return`${o}-${n}-${u}`}function fe(t,o){const n=new Date(t,o,1,0,0,0,0),u=new Date(t,o+1,0,23,59,59,999);return{startOfMonth:n,endOfMonth:u}}function pe(t){const o={weekday:"long",month:"short",day:"numeric",year:"numeric"};return t.toLocaleDateString("en-US",o)}function ye(t){const o={hour:"numeric",minute:"2-digit",hour12:!0};return t.toLocaleTimeString("en-US",o)}function be(t){return["January","February","March","April","May","June","July","August","September","October","November","December"][t]}function je(t,o){return o===0?{year:t-1,month:11}:{year:t,month:o-1}}function Ne(t,o){return o===11?{year:t+1,month:0}:{year:t,month:o+1}}const ve={loved:{icon:P,color:"text-pink-500",bgColor:"bg-pink-100",label:"Loved"},happy:{icon:R,color:"text-yellow-500",bgColor:"bg-yellow-100",label:"Happy"},content:{icon:z,color:"text-blue-500",bgColor:"bg-blue-100",label:"Content"},thoughtful:{icon:Y,color:"text-purple-500",bgColor:"bg-purple-100",label:"Thoughtful"},grateful:{icon:H,color:"text-green-500",bgColor:"bg-green-100",label:"Grateful"},sad:{icon:U,color:"text-gray-500",bgColor:"bg-gray-100",label:"Sad"},anxious:{icon:_,color:"text-orange-500",bgColor:"bg-orange-100",label:"Anxious"},frustrated:{icon:q,color:"text-red-500",bgColor:"bg-red-100",label:"Frustrated"},lonely:{icon:G,color:"text-indigo-500",bgColor:"bg-indigo-100",label:"Lonely"},tired:{icon:B,color:"text-slate-500",bgColor:"bg-slate-100",label:"Tired"}};function we({mood:t,onClose:o}){const n=a.useRef(null),u=a.useRef(null);if(a.useEffect(()=>{if(!t)return;const r=x=>{x.key==="Escape"&&o()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[t,o]),a.useEffect(()=>{if(!t||!n.current)return;u.current?.focus();const r=n.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(r.length===0)return;const x=r[0],j=r[r.length-1],f=N=>{N.key==="Tab"&&(N.shiftKey?document.activeElement===x&&(N.preventDefault(),j.focus()):document.activeElement===j&&(N.preventDefault(),x.focus()))};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[t]),!t)return null;const c=ve[t.mood],g=c.icon,p=new Date(t.timestamp),m=pe(p),l=ye(p);return e.jsx(I,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/50 z-40",onClick:o,"aria-hidden":"true","data-testid":"modal-backdrop"}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none",role:"dialog","aria-modal":"true","aria-labelledby":"mood-modal-title","data-testid":"mood-detail-modal",children:e.jsxs(b.div,{ref:n,initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:"bg-white rounded-t-3xl sm:rounded-3xl shadow-2xl w-full max-w-md p-6 pointer-events-auto relative",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{ref:u,onClick:o,className:"absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-pink-500","aria-label":"Close mood details modal","data-testid":"modal-close-button",children:e.jsx(X,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:`p-4 rounded-full ${c.bgColor}`,"aria-hidden":"true",children:e.jsx(g,{className:`w-8 h-8 ${c.color}`})}),e.jsxs("div",{children:[e.jsx("h2",{id:"mood-modal-title",className:`text-2xl font-semibold ${c.color}`,"data-testid":"modal-mood-type",children:c.label}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"How you were feeling"})]})]}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("span",{"data-testid":"modal-date",children:m})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Time:"}),e.jsx("span",{"data-testid":"modal-time",children:l})]})]}),t.note&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Note:"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-wrap","data-testid":"modal-note",children:t.note})]}),!t.note&&e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsx("p",{className:"text-sm text-gray-400 italic",children:"No note for this mood"})})]})})]})})}const L={loved:{icon:P,color:"text-pink-500",bgColor:"bg-pink-100"},happy:{icon:R,color:"text-yellow-500",bgColor:"bg-yellow-100"},content:{icon:z,color:"text-blue-500",bgColor:"bg-blue-100"},thoughtful:{icon:Y,color:"text-purple-500",bgColor:"bg-purple-100"},grateful:{icon:H,color:"text-green-500",bgColor:"bg-green-100"},sad:{icon:U,color:"text-gray-500",bgColor:"bg-gray-100"},anxious:{icon:_,color:"text-orange-500",bgColor:"bg-orange-100"},frustrated:{icon:q,color:"text-red-500",bgColor:"bg-red-100"},lonely:{icon:G,color:"text-indigo-500",bgColor:"bg-indigo-100"},tired:{icon:B,color:"text-slate-500",bgColor:"bg-slate-100"}},ke=a.memo(function({dateKey:o,dayNumber:n,isToday:u,mood:c,monthName:g,year:p,onClick:m}){const l=!!c,r=["aspect-square","rounded-lg","flex","flex-col","items-center","justify-center","relative","transition-all","duration-200","border-none","focus:outline-none","focus:ring-2","focus:ring-pink-500","focus:ring-offset-2",l?"cursor-pointer":"",u?"bg-pink-100 border-2 border-pink-500":l?L[c.mood].bgColor:"bg-gray-50 hover:bg-gray-100"].join(" ");return e.jsxs(b.button,{className:r,role:"gridcell","data-testid":`calendar-day-${o}`,"data-has-mood":l?"true":"false","aria-label":l?`${g} ${n}, ${p} - ${c.mood} mood. Press enter to view details.`:`${g} ${n}, ${p}`,"aria-disabled":!l,tabIndex:l?0:-1,onClick:()=>m(c),disabled:!l,whileHover:l?{scale:1.05}:void 0,whileTap:l?{scale:.95}:void 0,children:[e.jsx("span",{className:`text-sm font-medium ${u?"text-pink-700":"text-gray-700"}`,children:n}),l&&e.jsx(b.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1,type:"spring"},className:`mt-1 ${L[c.mood].color}`,children:(()=>{const x=L[c.mood].icon;return e.jsx(x,{className:"w-4 h-4"})})()})]})}),K=300;function Me(){const[t,o]=a.useState(()=>new Date().getFullYear()),[n,u]=a.useState(()=>new Date().getMonth()),[c,g]=a.useState([]),[p,m]=a.useState(new Map),[l,r]=a.useState(!0),[x,j]=a.useState(null),f=a.useRef(null),N=a.useRef(0),v=a.useCallback(async(s,h)=>{r(!0);const k=performance.now();try{const{startOfMonth:S,endOfMonth:A}=fe(s,h),T=await Z.getMoodsInRange(S,A),i=performance.now()-k,d=new Map;T.forEach(y=>{d.set(y.date,y)}),g(T),m(d)}catch(S){console.error("[MoodHistoryCalendar] Failed to load moods:",S),g([]),m(new Map)}finally{r(!1)}},[]);a.useEffect(()=>{v(t,n)},[t,n,v]);const M=a.useCallback(()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{const{year:s,month:h}=je(t,n);o(s),u(h)},K)},[t,n]),C=a.useCallback(()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{const{year:s,month:h}=Ne(t,n);o(s),u(h)},K)},[t,n]),F=a.useCallback(s=>{s&&j(s)},[]),O=a.useCallback(()=>{j(null)},[]);a.useEffect(()=>{const s=h=>{x||(h.key==="ArrowLeft"?M():h.key==="ArrowRight"&&C())};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[M,C,x]),a.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]),a.useEffect(()=>{!l&&D.length>0&&performance.now()-N.current},[l]);const D=xe(t,n),w=be(n);return a.useEffect(()=>{N.current=performance.now()}),e.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 py-6","data-testid":"mood-calendar",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:M,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2","aria-label":`Go to previous month from ${w} ${t}`,"data-testid":"calendar-nav-prev",children:e.jsx(ae,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800","data-testid":"calendar-month-header","aria-live":"polite","aria-atomic":"true",children:[w," ",t]}),e.jsx("button",{onClick:C,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2","aria-label":`Go to next month from ${w} ${t}`,"data-testid":"calendar-nav-next",children:e.jsx(se,{className:"w-6 h-6 text-gray-600"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",role:"row",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"text-center text-sm font-medium text-gray-500 py-2",role:"columnheader","aria-label":s==="Sun"?"Sunday":s==="Mon"?"Monday":s==="Tue"?"Tuesday":s==="Wed"?"Wednesday":s==="Thu"?"Thursday":s==="Fri"?"Friday":"Saturday",children:s},s))}),l?e.jsx("div",{className:"grid grid-cols-7 gap-2","data-testid":"calendar-loading",children:Array.from({length:35}).map((s,h)=>e.jsx("div",{className:"aspect-square rounded-lg bg-gray-100 animate-pulse"},h))}):e.jsx(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"grid grid-cols-7 gap-2",role:"grid","aria-label":`Calendar for ${w} ${t}`,children:D.map((s,h)=>{if(!s.date||!s.dayNumber)return e.jsx("div",{className:"aspect-square",role:"gridcell","aria-hidden":"true"},`empty-${h}`);const k=he(s.date),S=p.get(k);return e.jsx(ke,{dateKey:k,dayNumber:s.dayNumber,isToday:s.isToday,mood:S,monthName:w,year:t,onClick:F},k)})},`${t}-${n}`),!l&&c.length>0&&e.jsxs("div",{className:"mt-4 text-center text-sm text-gray-600",children:[c.length," ",c.length===1?"mood":"moods"," logged this month"]}),e.jsx(we,{mood:x,onClose:O})]})}const W={loved:{icon:P,label:"Loved"},happy:{icon:R,label:"Happy"},content:{icon:z,label:"Content"},thoughtful:{icon:Y,label:"Thoughtful"},grateful:{icon:H,label:"Grateful"}},J={sad:{icon:U,label:"Sad"},anxious:{icon:_,label:"Anxious"},frustrated:{icon:q,label:"Frustrated"},lonely:{icon:G,label:"Lonely"},tired:{icon:B,label:"Tired"}},E={...W,...J};function Oe(){const{addMoodEntry:t,getMoodForDate:o,syncStatus:n,loadMoods:u,syncPendingMoods:c}=Q(),[g,p]=a.useState("tracker"),[m,l]=a.useState([]),[r,x]=a.useState(""),[j,f]=a.useState(!1),[N,v]=a.useState(null),[M,C]=a.useState(null),[F,O]=a.useState(!1),[D,w]=a.useState(!1),s=200,h=s-r.length;a.useEffect(()=>{u()},[u]),a.useEffect(()=>{const i=new Date().toISOString().split("T")[0],d=o(i);d&&(d.moods&&d.moods.length>0?l(d.moods):l([d.mood]),x(d.note||""),f(!0))},[o]);const k=i=>{l(d=>d.includes(i)?d.filter(y=>y!==i):[...d,i]),v(null)},S=i=>{const d=i.target.value;d.length<=s&&(x(d),C(null))},A=async i=>{if(i.preventDefault(),m.length===0){v("Please select at least one mood");return}try{w(!0),v(null),C(null);const d=m[0];await t(d,r.trim()||void 0),O(!0),setTimeout(()=>O(!1),3e3),n.isOnline&&c().catch(y=>{console.error("[MoodTracker] Background sync failed:",y)})}catch(d){if(console.error("[MoodTracker] Failed to save mood entry:",d),te(d)){const y=d.fieldErrors;y.has("note")&&C(y.get("note")||null),y.has("mood")?v(y.get("mood")||null):v(d.message)}else v("Failed to save mood entry. Please try again.")}finally{w(!1)}},T=m.length>0;return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20","data-testid":"mood-tracker",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("button",{onClick:()=>p("tracker"),className:`flex-1 py-4 px-4 text-center font-medium transition-colors relative ${g==="tracker"?"text-pink-600":"text-gray-600 hover:text-gray-900"}`,"data-testid":"mood-tab-tracker",children:["Log Mood",g==="tracker"&&e.jsx(b.div,{layoutId:"active-tab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-pink-600",transition:{type:"spring",stiffness:500,damping:30}})]}),e.jsxs("button",{onClick:()=>p("history"),className:`flex-1 py-4 px-4 text-center font-medium transition-colors relative flex items-center justify-center gap-2 ${g==="history"?"text-pink-600":"text-gray-600 hover:text-gray-900"}`,"data-testid":"mood-tab-history",children:[e.jsx(ee,{className:"w-4 h-4"}),"History",g==="history"&&e.jsx(b.div,{layoutId:"active-tab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-pink-600",transition:{type:"spring",stiffness:500,damping:30}})]})]})})}),e.jsx(I,{mode:"wait",children:g==="tracker"?e.jsxs(b.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"max-w-2xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"How are you feeling?"}),e.jsx("p",{className:"text-gray-600",children:"Track your mood for today"})]}),e.jsxs("div",{className:"mb-6 flex items-center gap-2 text-sm",children:[n.isOnline?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-gray-600",children:"Online"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Offline"})]}),n.pendingMoods>0&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["(",n.pendingMoods," pending sync)"]})]}),e.jsx(I,{children:F&&e.jsxs(b.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-4 flex items-center gap-2 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800","data-testid":"mood-success-toast",children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:j?"Mood updated successfully!":"Mood logged successfully!"})]})}),N&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800","data-testid":"mood-error-message",children:N}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"How are you feeling? (select all that apply)"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2 uppercase tracking-wide",children:"Positive"}),e.jsx("div",{className:"grid grid-cols-3 gap-3 sm:grid-cols-5",children:Object.keys(W).map(i=>e.jsx(V,{mood:i,icon:E[i].icon,label:E[i].label,isSelected:m.includes(i),onClick:()=>k(i)},i))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2 uppercase tracking-wide",children:"Challenging"}),e.jsx("div",{className:"grid grid-cols-3 gap-3 sm:grid-cols-5",children:Object.keys(J).map(i=>e.jsx(V,{mood:i,icon:E[i].icon,label:E[i].label,isSelected:m.includes(i),onClick:()=>k(i)},i))})]}),m.length>0&&e.jsxs("p",{className:"text-sm text-gray-600 mt-3",children:["Selected: ",m.map(i=>E[i].label).join(", ")]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mood-note",className:"block text-sm font-medium text-gray-700 mb-2",children:"Add a note (optional)"}),e.jsx("textarea",{id:"mood-note",value:r,onChange:S,placeholder:"What made you feel this way?",rows:4,maxLength:200,className:`w-full px-4 py-3 border rounded-lg resize-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-colors ${M?"border-red-300 bg-red-50":"border-gray-300"}`,"data-testid":"mood-note-input"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[M?e.jsx("span",{className:"text-sm text-red-600","data-testid":"mood-note-error",children:M}):e.jsx("span",{className:"text-sm text-gray-500",children:"Share your thoughts"}),e.jsxs("span",{className:`text-sm ${h<20?"text-orange-600":"text-gray-500"}`,"data-testid":"mood-char-counter",children:[h,"/",s]})]})]}),e.jsx("button",{type:"submit",disabled:!T||D,className:`w-full py-3 px-6 rounded-lg font-medium transition-colors ${T&&!D?"bg-pink-500 hover:bg-pink-600 text-white":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,"data-testid":"mood-submit-button",children:D?"Saving...":j?"Update Mood":"Log Mood"})]})]},"tracker"):e.jsx(b.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},children:e.jsx(Me,{})},"history")})]})}export{Oe as MoodTracker};
