import{j as e,m as y,A}from"./vendor-animation-Gbi4aw9F.js";import{r as o}from"./vendor-state-B7YfVSdG.js";import{c as T,S as I,a as H,H as R,X as B,m as Y,u as z,b as K,i as U}from"./index-CYs3EsE7.js";import{M as P,a as q}from"./message-circle-ThlgSiwl.js";import"./vendor-react-DyfnzrEv.js";import"./vendor-supabase-Bty1Idrm.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],J=T("chevron-left",W);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],X=T("chevron-right",V);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Q=T("circle-check-big",Z);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]],te=T("cloud-off",ee);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],oe=T("cloud",ae);function ne({mood:t,icon:a,label:n,isSelected:c,onClick:i}){return e.jsxs(y.button,{onClick:i,whileHover:{scale:1.05},whileTap:{scale:.95},animate:{scale:c?1.1:1,backgroundColor:c?"rgba(236, 72, 153, 0.1)":"rgba(243, 244, 246, 1)"},transition:{type:"spring",stiffness:300,damping:20},className:`flex flex-col items-center justify-center gap-2 p-4 rounded-2xl border-2 transition-colors ${c?"border-pink-500 text-pink-500":"border-gray-200 text-gray-400 hover:border-gray-300 hover:text-gray-600"}`,"data-testid":`mood-button-${t}`,"aria-label":`${n} mood`,"aria-pressed":c,children:[e.jsx(a,{className:"w-8 h-8"}),e.jsx("span",{className:"text-sm font-medium",children:n})]})}function se(t,a){return new Date(t,a+1,0).getDate()}function re(t,a){return new Date(t,a,1).getDay()}function ie(t,a){const n=se(t,a),c=re(t,a),i=new Date,u=i.getFullYear(),p=i.getMonth(),f=i.getDate(),l=[];for(let r=0;r<c;r++)l.push({date:null,dayNumber:null,isToday:!1,isCurrentMonth:!1});for(let r=1;r<=n;r++){const m=new Date(t,a,r),b=t===u&&a===p&&r===f;l.push({date:m,dayNumber:r,isToday:b,isCurrentMonth:!0})}return l}function le(t){const a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0");return`${a}-${n}-${c}`}function ce(t,a){const n=new Date(t,a,1,0,0,0,0),c=new Date(t,a+1,0,23,59,59,999);return{startOfMonth:n,endOfMonth:c}}function de(t){const a={weekday:"long",month:"short",day:"numeric",year:"numeric"};return t.toLocaleDateString("en-US",a)}function ue(t){const a={hour:"numeric",minute:"2-digit",hour12:!0};return t.toLocaleTimeString("en-US",a)}function me(t){return["January","February","March","April","May","June","July","August","September","October","November","December"][t]}function ge(t,a){return a===0?{year:t-1,month:11}:{year:t,month:a-1}}function he(t,a){return a===11?{year:t+1,month:0}:{year:t,month:a+1}}const fe={loved:{icon:R,color:"text-pink-500",bgColor:"bg-pink-100",label:"Loved"},happy:{icon:H,color:"text-yellow-500",bgColor:"bg-yellow-100",label:"Happy"},content:{icon:q,color:"text-blue-500",bgColor:"bg-blue-100",label:"Content"},thoughtful:{icon:P,color:"text-purple-500",bgColor:"bg-purple-100",label:"Thoughtful"},grateful:{icon:I,color:"text-green-500",bgColor:"bg-green-100",label:"Grateful"}};function xe({mood:t,onClose:a}){const n=o.useRef(null),c=o.useRef(null);if(o.useEffect(()=>{if(!t)return;const r=m=>{m.key==="Escape"&&a()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[t,a]),o.useEffect(()=>{if(!t||!n.current)return;c.current?.focus();const r=n.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(r.length===0)return;const m=r[0],b=r[r.length-1],x=v=>{v.key==="Tab"&&(v.shiftKey?document.activeElement===m&&(v.preventDefault(),b.focus()):document.activeElement===b&&(v.preventDefault(),m.focus()))};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[t]),!t)return null;const i=fe[t.mood],u=i.icon,p=new Date(t.timestamp),f=de(p),l=ue(p);return e.jsx(A,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/50 z-40",onClick:a,"aria-hidden":"true","data-testid":"modal-backdrop"}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none",role:"dialog","aria-modal":"true","aria-labelledby":"mood-modal-title","data-testid":"mood-detail-modal",children:e.jsxs(y.div,{ref:n,initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:"bg-white rounded-t-3xl sm:rounded-3xl shadow-2xl w-full max-w-md p-6 pointer-events-auto relative",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{ref:c,onClick:a,className:"absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-pink-500","aria-label":"Close mood details modal","data-testid":"modal-close-button",children:e.jsx(B,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:`p-4 rounded-full ${i.bgColor}`,"aria-hidden":"true",children:e.jsx(u,{className:`w-8 h-8 ${i.color}`})}),e.jsxs("div",{children:[e.jsx("h2",{id:"mood-modal-title",className:`text-2xl font-semibold ${i.color}`,"data-testid":"modal-mood-type",children:i.label}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"How you were feeling"})]})]}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("span",{"data-testid":"modal-date",children:f})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Time:"}),e.jsx("span",{"data-testid":"modal-time",children:l})]})]}),t.note&&e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Note:"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-wrap","data-testid":"modal-note",children:t.note})]}),!t.note&&e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsx("p",{className:"text-sm text-gray-400 italic",children:"No note for this mood"})})]})})]})})}const L={loved:{icon:R,color:"text-pink-500",bgColor:"bg-pink-100"},happy:{icon:H,color:"text-yellow-500",bgColor:"bg-yellow-100"},content:{icon:q,color:"text-blue-500",bgColor:"bg-blue-100"},thoughtful:{icon:P,color:"text-purple-500",bgColor:"bg-purple-100"},grateful:{icon:I,color:"text-green-500",bgColor:"bg-green-100"}},pe=o.memo(function({dateKey:a,dayNumber:n,isToday:c,mood:i,monthName:u,year:p,onClick:f}){const l=!!i,r=["aspect-square","rounded-lg","flex","flex-col","items-center","justify-center","relative","transition-all","duration-200","border-none","focus:outline-none","focus:ring-2","focus:ring-pink-500","focus:ring-offset-2",l?"cursor-pointer":"",c?"bg-pink-100 border-2 border-pink-500":l?L[i.mood].bgColor:"bg-gray-50 hover:bg-gray-100"].join(" ");return e.jsxs(y.button,{className:r,role:"gridcell","data-testid":`calendar-day-${a}`,"data-has-mood":l?"true":"false","aria-label":l?`${u} ${n}, ${p} - ${i.mood} mood. Press enter to view details.`:`${u} ${n}, ${p}`,"aria-disabled":!l,tabIndex:l?0:-1,onClick:()=>f(i),disabled:!l,whileHover:l?{scale:1.05}:void 0,whileTap:l?{scale:.95}:void 0,children:[e.jsx("span",{className:`text-sm font-medium ${c?"text-pink-700":"text-gray-700"}`,children:n}),l&&e.jsx(y.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1,type:"spring"},className:`mt-1 ${L[i.mood].color}`,children:(()=>{const m=L[i.mood].icon;return e.jsx(m,{className:"w-4 h-4"})})()})]})}),G=300;function ye(){const[t,a]=o.useState(()=>new Date().getFullYear()),[n,c]=o.useState(()=>new Date().getMonth()),[i,u]=o.useState([]),[p,f]=o.useState(new Map),[l,r]=o.useState(!0),[m,b]=o.useState(null),x=o.useRef(null),v=o.useRef(0),j=o.useCallback(async(s,g)=>{r(!0);const M=performance.now();try{const{startOfMonth:C,endOfMonth:F}=ce(s,g),$=await Y.getMoodsInRange(C,F),h=performance.now()-M,d=new Map;$.forEach(S=>{d.set(S.date,S)}),u($),f(d)}catch(C){console.error("[MoodHistoryCalendar] Failed to load moods:",C),u([]),f(new Map)}finally{r(!1)}},[]);o.useEffect(()=>{j(t,n)},[t,n,j]);const w=o.useCallback(()=>{x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{const{year:s,month:g}=ge(t,n);a(s),c(g)},G)},[t,n]),k=o.useCallback(()=>{x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{const{year:s,month:g}=he(t,n);a(s),c(g)},G)},[t,n]),O=o.useCallback(s=>{s&&b(s)},[]),E=o.useCallback(()=>{b(null)},[]);o.useEffect(()=>{const s=g=>{m||(g.key==="ArrowLeft"?w():g.key==="ArrowRight"&&k())};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[w,k,m]),o.useEffect(()=>()=>{x.current&&clearTimeout(x.current)},[]),o.useEffect(()=>{!l&&D.length>0&&performance.now()-v.current},[l]);const D=ie(t,n),N=me(n);return o.useEffect(()=>{v.current=performance.now()}),e.jsxs("div",{className:"w-full max-w-4xl mx-auto px-4 py-6","data-testid":"mood-calendar",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:w,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2","aria-label":`Go to previous month from ${N} ${t}`,"data-testid":"calendar-nav-prev",children:e.jsx(J,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800","data-testid":"calendar-month-header","aria-live":"polite","aria-atomic":"true",children:[N," ",t]}),e.jsx("button",{onClick:k,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2","aria-label":`Go to next month from ${N} ${t}`,"data-testid":"calendar-nav-next",children:e.jsx(X,{className:"w-6 h-6 text-gray-600"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",role:"row",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(s=>e.jsx("div",{className:"text-center text-sm font-medium text-gray-500 py-2",role:"columnheader","aria-label":s==="Sun"?"Sunday":s==="Mon"?"Monday":s==="Tue"?"Tuesday":s==="Wed"?"Wednesday":s==="Thu"?"Thursday":s==="Fri"?"Friday":"Saturday",children:s},s))}),l?e.jsx("div",{className:"grid grid-cols-7 gap-2","data-testid":"calendar-loading",children:Array.from({length:35}).map((s,g)=>e.jsx("div",{className:"aspect-square rounded-lg bg-gray-100 animate-pulse"},g))}):e.jsx(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"grid grid-cols-7 gap-2",role:"grid","aria-label":`Calendar for ${N} ${t}`,children:D.map((s,g)=>{if(!s.date||!s.dayNumber)return e.jsx("div",{className:"aspect-square",role:"gridcell","aria-hidden":"true"},`empty-${g}`);const M=le(s.date),C=p.get(M);return e.jsx(pe,{dateKey:M,dayNumber:s.dayNumber,isToday:s.isToday,mood:C,monthName:N,year:t,onClick:O},M)})},`${t}-${n}`),!l&&i.length>0&&e.jsxs("div",{className:"mt-4 text-center text-sm text-gray-600",children:[i.length," ",i.length===1?"mood":"moods"," logged this month"]}),e.jsx(xe,{mood:m,onClose:E})]})}const _={loved:{icon:R,label:"Loved"},happy:{icon:H,label:"Happy"},content:{icon:q,label:"Content"},thoughtful:{icon:P,label:"Thoughtful"},grateful:{icon:I,label:"Grateful"}};function Me(){const{addMoodEntry:t,getMoodForDate:a,syncStatus:n,loadMoods:c,syncPendingMoods:i}=z(),[u,p]=o.useState("tracker"),[f,l]=o.useState(null),[r,m]=o.useState(""),[b,x]=o.useState(!1),[v,j]=o.useState(null),[w,k]=o.useState(null),[O,E]=o.useState(!1),[D,N]=o.useState(!1),s=200,g=s-r.length;o.useEffect(()=>{c()},[c]),o.useEffect(()=>{const h=new Date().toISOString().split("T")[0],d=a(h);d&&(l(d.mood),m(d.note||""),x(!0))},[a]);const M=h=>{l(h),j(null)},C=h=>{const d=h.target.value;d.length<=s&&(m(d),k(null))},F=async h=>{if(h.preventDefault(),!f){j("Please select a mood");return}try{N(!0),j(null),k(null),await t(f,r.trim()||void 0),E(!0),setTimeout(()=>E(!1),3e3),n.isOnline&&i().catch(d=>{console.error("[MoodTracker] Background sync failed:",d)})}catch(d){if(console.error("[MoodTracker] Failed to save mood entry:",d),U(d)){const S=d.fieldErrors;S.has("note")&&k(S.get("note")||null),S.has("mood")?j(S.get("mood")||null):j(d.message)}else j("Failed to save mood entry. Please try again.")}finally{N(!1)}},$=f!==null;return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20","data-testid":"mood-tracker",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("button",{onClick:()=>p("tracker"),className:`flex-1 py-4 px-4 text-center font-medium transition-colors relative ${u==="tracker"?"text-pink-600":"text-gray-600 hover:text-gray-900"}`,"data-testid":"mood-tab-tracker",children:["Log Mood",u==="tracker"&&e.jsx(y.div,{layoutId:"active-tab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-pink-600",transition:{type:"spring",stiffness:500,damping:30}})]}),e.jsxs("button",{onClick:()=>p("history"),className:`flex-1 py-4 px-4 text-center font-medium transition-colors relative flex items-center justify-center gap-2 ${u==="history"?"text-pink-600":"text-gray-600 hover:text-gray-900"}`,"data-testid":"mood-tab-history",children:[e.jsx(K,{className:"w-4 h-4"}),"History",u==="history"&&e.jsx(y.div,{layoutId:"active-tab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-pink-600",transition:{type:"spring",stiffness:500,damping:30}})]})]})})}),e.jsx(A,{mode:"wait",children:u==="tracker"?e.jsxs(y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"max-w-2xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"How are you feeling?"}),e.jsx("p",{className:"text-gray-600",children:"Track your mood for today"})]}),e.jsxs("div",{className:"mb-6 flex items-center gap-2 text-sm",children:[n.isOnline?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-gray-600",children:"Online"})]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Offline"})]}),n.pendingMoods>0&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["(",n.pendingMoods," pending sync)"]})]}),e.jsx(A,{children:O&&e.jsxs(y.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"mb-4 flex items-center gap-2 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800","data-testid":"mood-success-toast",children:[e.jsx(Q,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:b?"Mood updated successfully!":"Mood logged successfully!"})]})}),v&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800","data-testid":"mood-error-message",children:v}),e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select your mood"}),e.jsx("div",{className:"grid grid-cols-3 gap-3 sm:grid-cols-5",children:Object.keys(_).map(h=>e.jsx(ne,{mood:h,icon:_[h].icon,label:_[h].label,isSelected:f===h,onClick:()=>M(h)},h))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mood-note",className:"block text-sm font-medium text-gray-700 mb-2",children:"Add a note (optional)"}),e.jsx("textarea",{id:"mood-note",value:r,onChange:C,placeholder:"What made you feel this way?",rows:4,maxLength:200,className:`w-full px-4 py-3 border rounded-lg resize-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-colors ${w?"border-red-300 bg-red-50":"border-gray-300"}`,"data-testid":"mood-note-input"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[w?e.jsx("span",{className:"text-sm text-red-600","data-testid":"mood-note-error",children:w}):e.jsx("span",{className:"text-sm text-gray-500",children:"Share your thoughts"}),e.jsxs("span",{className:`text-sm ${g<20?"text-orange-600":"text-gray-500"}`,"data-testid":"mood-char-counter",children:[g,"/",s]})]})]}),e.jsx("button",{type:"submit",disabled:!$||D,className:`w-full py-3 px-6 rounded-lg font-medium transition-colors ${$&&!D?"bg-pink-500 hover:bg-pink-600 text-white":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,"data-testid":"mood-submit-button",children:D?"Saving...":b?"Update Mood":"Log Mood"})]})]},"tracker"):e.jsx(y.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},children:e.jsx(ye,{})},"history")})]})}export{Me as MoodTracker};
